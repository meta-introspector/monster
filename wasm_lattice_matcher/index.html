<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Monster Lattice Matcher</title>
    <style>
        body {
            font-family: monospace;
            background: #000;
            color: #0f0;
            padding: 20px;
        }
        #canvas {
            border: 1px solid #0f0;
            background: #001100;
        }
        .controls {
            margin: 20px 0;
        }
        input, button {
            background: #002200;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 10px;
            font-family: monospace;
        }
        #output {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #0f0;
            min-height: 200px;
        }
        .match {
            color: #ff0;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <h1>ðŸ”® Monster Lattice Matcher</h1>
    <p>Interactive Value Lattice â†” Qwen Shard Resonance</p>
    
    <div class="controls">
        <input type="text" id="valueInput" placeholder="Enter value (e.g., 24, 71)" />
        <button onclick="matchValue()">Match</button>
        <button onclick="scanAllLayers()">Scan All 71 Layers</button>
        <button onclick="visualizeResonance()">Visualize</button>
    </div>
    
    <div class="controls">
        <label>Layer: <input type="range" id="layerSlider" min="0" max="70" value="0" oninput="updateLayer(this.value)" /></label>
        <span id="layerDisplay">0</span>
        <span id="primeDisplay">Prime: 2</span>
    </div>
    
    <canvas id="canvas" width="800" height="600"></canvas>
    
    <div id="output"></div>
    
    <script type="module">
        import init, { LatticeMatcher, init_panic_hook } from './pkg/wasm_lattice_matcher.js';
        
        let matcher;
        let canvas, ctx;
        
        async function setup() {
            await init();
            init_panic_hook();
            
            matcher = new LatticeMatcher();
            
            // Load value lattice (simulated)
            const values = [
                ["24", 155], ["71", 21], ["46", 3], ["20", 5],
                ["23", 15], ["47", 19], ["31", 17], ["0", 27],
                ["1", 13], ["2", 1], ["3", 4], ["5", 6]
            ];
            
            for (const [val, godel] of values) {
                matcher.add_value(val, godel);
            }
            
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');
            
            console.log('âœ… Lattice Matcher ready');
        }
        
        window.matchValue = function() {
            const value = document.getElementById('valueInput').value;
            const matches = matcher.find_matches(value);
            
            document.getElementById('output').innerHTML = 
                `<h3>Matches for value: ${value}</h3><pre>${matches}</pre>`;
        };
        
        window.updateLayer = function(layer) {
            matcher.set_layer(parseInt(layer));
            document.getElementById('layerDisplay').textContent = layer;
            
            const prime = matcher.get_prime_for_layer(parseInt(layer));
            document.getElementById('primeDisplay').textContent = `Prime: ${prime}`;
        };
        
        window.scanAllLayers = function() {
            const value = document.getElementById('valueInput').value;
            let output = '<h3>Scanning all 71 layers...</h3>';
            
            for (let layer = 0; layer < 71; layer++) {
                const prime = matcher.get_prime_for_layer(layer);
                const resonance = matcher.match_with_prime(value, prime);
                
                if (resonance > 0.5) {
                    output += `<div class="match">Layer ${layer}: Prime ${prime} - Resonance ${resonance.toFixed(2)}</div>`;
                }
            }
            
            document.getElementById('output').innerHTML = output;
        };
        
        window.visualizeResonance = function() {
            const value = document.getElementById('valueInput').value;
            const field = matcher.compute_resonance_field(value);
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw resonance field
            const barWidth = canvas.width / field.length;
            
            for (let i = 0; i < field.length; i++) {
                const height = field[i] * canvas.height;
                const hue = field[i] * 120; // Green to red
                
                ctx.fillStyle = `hsl(${hue}, 100%, 50%)`;
                ctx.fillRect(i * barWidth, canvas.height - height, barWidth - 2, height);
                
                // Label
                ctx.fillStyle = '#0f0';
                ctx.font = '10px monospace';
                const prime = matcher.get_prime_for_layer(i);
                ctx.fillText(prime, i * barWidth + 5, canvas.height - 5);
            }
            
            // Draw 71-layer spiral
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const maxRadius = Math.min(centerX, centerY) - 50;
            
            ctx.strokeStyle = '#0f0';
            ctx.beginPath();
            
            for (let layer = 0; layer < 71; layer++) {
                const angle = (layer / 71) * Math.PI * 2 * 5; // 5 spirals
                const radius = (layer / 71) * maxRadius;
                const x = centerX + Math.cos(angle) * radius;
                const y = centerY + Math.sin(angle) * radius;
                
                if (layer === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
                
                // Highlight resonant layers
                const prime = matcher.get_prime_for_layer(layer);
                const resonance = matcher.match_with_prime(value, prime);
                
                if (resonance > 0.5) {
                    ctx.fillStyle = '#ff0';
                    ctx.fillRect(x - 3, y - 3, 6, 6);
                }
            }
            
            ctx.stroke();
        };
        
        setup();
    </script>
</body>
</html>
